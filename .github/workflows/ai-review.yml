name: AI Code Review

on:
    pull_request:
        types: [opened, synchronize, reopened]

permissions:
    pull-requests: write
    contents: read

jobs:
    review:
        runs-on: ubuntu-latest

        services:
            ollama:
                image: ollama/ollama:latest
                ports:
                    - 11434:11434
                options: >-
                    --health-cmd "curl --silent --fail http://localhost:11434/api/tags || exit 1"
                    --health-interval 5s
                    --health-timeout 2s
                    --health-retries 20

        steps:
            - name: Checkout repo
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Pull AI model
              run: |
                  echo "⏳ Pobieram model..."
                  curl -s -X POST http://localhost:11434/api/pull -d '{"model": "starcoder2:3b"}'
                  echo "✅ Model pobrany"

            - name: Run AI
